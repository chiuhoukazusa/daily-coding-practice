#!/bin/bash
# generate_daily_report.sh - ç”Ÿæˆæ¯æ—¥ç¼–ç¨‹å®žè·µæ—¥æŠ¥æ¡†æž¶

set -e

DATE=$(date +%Y-%m-%d)
YEAR=$(date +%Y)
MONTH=$(date +%m)
DAY=$(date +%d)

# æŸ¥æ‰¾ä»Šå¤©çš„é¡¹ç›®ç›®å½•
PROJECT_DIR=$(find "$YEAR/$MONTH" -maxdepth 1 -type d -name "$MONTH-$DAY-*" 2>/dev/null | head -1)

if [ -z "$PROJECT_DIR" ]; then
    echo "âŒ æœªæ‰¾åˆ°ä»Šæ—¥é¡¹ç›®ç›®å½•ï¼ˆ$YEAR/$MONTH/$MONTH-$DAY-*ï¼‰"
    exit 1
fi

PROJECT_NAME=$(basename "$PROJECT_DIR")

# æå–ä¿¡æ¯
CODE_FILES=$(find "$PROJECT_DIR" -name "*.cpp" -o -name "*.py" -o -name "*.js" -o -name "*.go" 2>/dev/null)
CODE_LINES=$(echo "$CODE_FILES" | xargs wc -l 2>/dev/null | tail -1 | awk '{print $1}')
COMMIT_HASH=$(git log --oneline -1 "$PROJECT_DIR" 2>/dev/null | awk '{print $1}')
START_TIME=$(git log --format=%ai --reverse "$PROJECT_DIR" 2>/dev/null | head -1 | awk '{print $2}' | cut -d: -f1,2)
END_TIME=$(git log --format=%ai "$PROJECT_DIR" 2>/dev/null | head -1 | awk '{print $2}' | cut -d: -f1,2)

# è®¡ç®—è€—æ—¶
if [ -n "$START_TIME" ] && [ -n "$END_TIME" ]; then
    START_MIN=$(echo "$START_TIME" | awk -F: '{print $1*60 + $2}')
    END_MIN=$(echo "$END_TIME" | awk -F: '{print $1*60 + $2}')
    DURATION=$((END_MIN - START_MIN))
    if [ $DURATION -lt 0 ]; then
        DURATION=$((DURATION + 1440))  # è·¨å¤©çš„æƒ…å†µ
    fi
    DURATION_STR="ï¼ˆè€—æ—¶ $DURATION åˆ†é’Ÿï¼‰"
else
    DURATION_STR=""
fi

# åˆ›å»º reports ç›®å½•
mkdir -p reports

# ç”Ÿæˆæ—¥æŠ¥æ¡†æž¶
cat > reports/$DATE.md << EOF
# æ¯æ—¥ç¼–ç¨‹å®žè·µ - $DATE

## ðŸ“¦ é¡¹ç›®æ¦‚è§ˆ
- **é¡¹ç›®åç§°**ï¼š$PROJECT_NAME
- **é¡¹ç›®ç›®æ ‡**ï¼šï¼ˆè¯·å¡«å†™ï¼‰
- **æŠ€æœ¯æ ˆ**ï¼šC++ / Python / JavaScript / ...ï¼ˆè¯·ç¡®è®¤ï¼‰
- **å®Œæˆæ—¶é—´**ï¼š$START_TIME - $END_TIME $DURATION_STR
- **ä»£ç è¡Œæ•°**ï¼š$CODE_LINES è¡Œ
- **è¿­ä»£æ¬¡æ•°**ï¼šï¼ˆè¯·å¡«å†™ï¼‰
- **æäº¤è®°å½•**ï¼šcommit \`$COMMIT_HASH\`

## ðŸŽ¯ æ ¸å¿ƒåŠŸèƒ½
### å®žçŽ°çš„åŠŸèƒ½
1. **åŠŸèƒ½1**
   - æè¿°ï¼šï¼ˆè¯·å¡«å†™ï¼‰
   - æŠ€æœ¯ï¼šï¼ˆè¯·å¡«å†™ï¼‰
   - éš¾åº¦ï¼šâ­â­â­â­â­ï¼ˆè¯·è¯„åˆ†ï¼‰

2. **åŠŸèƒ½2**
   - æè¿°ï¼šï¼ˆè¯·å¡«å†™ï¼‰

### æœªå®žçŽ°çš„åŠŸèƒ½ï¼ˆç•™å¾…æœªæ¥ï¼‰
- ï¼ˆè¯·å¡«å†™ï¼Œå¦‚æžœæœ‰ï¼‰

## ðŸ› é‡åˆ°çš„é—®é¢˜ä¸Žè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1ï¼šï¼ˆè¯·å¡«å†™é—®é¢˜æ ‡é¢˜ï¼‰
**çŽ°è±¡**ï¼š
- ï¼ˆè¯·æè¿°å…·ä½“çŽ°è±¡ï¼‰

**æ ¹æœ¬åŽŸå› **ï¼š
- ï¼ˆè¯·åˆ†æžæ ¹æœ¬åŽŸå› ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
\`\`\`cpp
// ä¿®å¤å‰
ï¼ˆè¯·ç²˜è´´é”™è¯¯ä»£ç ï¼‰

// ä¿®å¤åŽ
ï¼ˆè¯·ç²˜è´´æ­£ç¡®ä»£ç ï¼‰
\`\`\`

**å­¦åˆ°çš„æ•™è®­**ï¼š
- ï¼ˆè¯·æ€»ç»“æ•™è®­ï¼‰

**é¿å…æŽªæ–½**ï¼š
- ï¼ˆè¯·è¯´æ˜Žå¦‚ä½•é¿å…ï¼‰

---

## ðŸ“š æŠ€æœ¯æ€»ç»“

### å­¦åˆ°çš„æŠ€æœ¯ç‚¹
1. **æŠ€æœ¯ç‚¹1**
   - æ ¸å¿ƒæ¦‚å¿µï¼šï¼ˆè¯·è§£é‡Šï¼‰
   - åº”ç”¨åœºæ™¯ï¼šï¼ˆè¯·è¯´æ˜Žï¼‰

2. **æŠ€æœ¯ç‚¹2**
   - æ ¸å¿ƒæ¦‚å¿µï¼šï¼ˆè¯·è§£é‡Šï¼‰

### ä½¿ç”¨çš„æŠ€å·§/æ¨¡å¼
- **æŠ€å·§1**ï¼šï¼ˆè¯·æè¿°ï¼‰

## ðŸ“Š é‡åŒ–æŒ‡æ ‡
- **æ¸²æŸ“æ—¶é—´**ï¼šï¼ˆè¯·å¡«å†™ï¼Œå¦‚æžœé€‚ç”¨ï¼‰
- **ç¼–è¯‘æ—¶é—´**ï¼šï¼ˆè¯·å¡«å†™ï¼‰
- **æ–‡ä»¶å¤§å°**ï¼šï¼ˆè¯·å¡«å†™ï¼‰

## ðŸ”— äº§å‡º
- **ä»£ç ä»“åº“**ï¼š[GitHub](https://github.com/chiuhoukazusa/daily-coding-practice/tree/main/$PROJECT_DIR)
- **åšå®¢æ–‡ç« **ï¼šï¼ˆè¯·å¡«å†™é“¾æŽ¥ï¼‰
- **å›¾ç‰‡/æ¼”ç¤º**ï¼šï¼ˆè¯·å¡«å†™é“¾æŽ¥ï¼‰

## ðŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’
### çŸ­æœŸï¼ˆæ˜Žå¤©/æœ¬å‘¨ï¼‰
- [ ] ï¼ˆè¯·å¡«å†™ï¼‰

### ä¸­æœŸï¼ˆæœ¬æœˆï¼‰
- [ ] ï¼ˆè¯·å¡«å†™ï¼‰

---

**æ€»ç»“**ï¼šä»Šå¤© ï¼ˆè¯·ç”¨ä¸€å¥è¯æ€»ç»“æ”¶èŽ·ï¼‰
EOF

echo "âœ… æ—¥æŠ¥æ¡†æž¶å·²ç”Ÿæˆï¼šreports/$DATE.md"
echo "ðŸ“ è¯·æ‰‹åŠ¨è¡¥å……æ ¸å¿ƒå†…å®¹ï¼š"
echo "   - æ ¸å¿ƒåŠŸèƒ½æè¿°"
echo "   - é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ"
echo "   - æŠ€æœ¯æ€»ç»“"
echo "   - ä¸‹ä¸€æ­¥è®¡åˆ’"
echo ""
echo "ðŸ’¡ æç¤ºï¼šåœ¨è®°å¿†æ–°é²œæ—¶ç«‹åˆ»å¡«å†™ï¼Œä¸è¦æ‹–åˆ°ç¬¬äºŒå¤©ï¼"
